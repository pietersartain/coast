<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="stylesheet" href="../assets/bootstrap-4.0.0alpha.min.css">
    <link rel="stylesheet" href="channel.css">

    <title>Coast</title>

  </head>
  <body>

    <div class="container-fluid">
      <div class="row">

        <div id="serverlist">
          <ul data-bind="foreach: servers">
            <li data-bind="html: $data.server_name"></li>
          </ul>
          <button type="button" id="add_server_btn" data-toggle="modal" data-target="#server_modal">&plus;</button>
        </div>

        <div id="channellist" data-bind="if: selected_server().connected">
          <h2 id="channellist-header">Channels</h2>
          <div id="channellist-content" data-bind="foreach: selected_server().channels">
            <li>
              <div data-bind="click: $parent.selectChannel">
                <span>#</span><span data-bind="html: $data.channel_name"></span>
              </div>
            </li>
          </div>
          <button type="button" id="add_channel_btn" data-toggle="modal" data-target="#channel_modal">&plus;</button>
        </div>

        <div id="channel" data-bind="with: selected_server().selected_channel()">
          <h2 id="channel-header" data-bind="html: channel_name"></h2>
          <div id="channel-content"></div>
          <textarea id="channel-input" class="input"
            data-bind="event: { keyup: sendMessage }"
            ></textarea>
        </div>
      </div>
    </div>

    <div class="modal fade" id="server_modal" data-keyboard="false" data-backdrop="static">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">Add new server</h4>
          </div>
          <div class="modal-body">
            <div><input type="text" name="server_name" placeholder="Server name" size="44"></div>
            <div>
              <input type="text" name="nick_name" placeholder="Nick name ...">@
              <input type="text" name="server_addr" placeholder="Server address ...">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="add_server" data-bind="click: addServerBind">Add new server</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="channel_modal" data-keyboard="false" data-backdrop="static">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title">Join new channel</h4>
          </div>
          <div class="modal-body">
            <div>
              <input type="text" name="channel_name" placeholder="New channel name ..." size="44">
              <button type="button" class="btn btn-primary" id="create_channel" data-bind="click: selected_server().createChannel">Create channel</button>
            </div>
            <div>
              <ul data-bind="foreach: selected_server.getChannelList">
                <li data-bind="click: selected_server.joinChannel; html: $data.server_name"></li>
              </ul>
            </div>
          </div>
          <div class="modal-footer">
            
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

  </body>

  <script>
    // You can also require other files to run in this process
    var $, jQuery, ko;
    $ = jQuery = require('jquery')
    ko = require('knockout')

    require('../assets/bootstrap-4.0.0alpha.min.js')

    var ifs = require('./interface.js')

    $(document).ready(function() {
      var interface = new ifs.InterfaceModel(ko);
      ko.applyBindings(interface /*, document.getElementById("serverlist") */);
    });

    </script>
</html>